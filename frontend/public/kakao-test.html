<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kakao SDK Test</title>
    <style>
        body { font-family: monospace; padding: 20px; }
        .log { margin: 5px 0; padding: 5px; background: #f0f0f0; }
        .success { background: #d4edda; }
        .error { background: #f8d7da; }
        .info { background: #d1ecf1; }
    </style>
</head>
<body>
    <h1>Kakao SDK Loading Test</h1>
    <div id="logs"></div>

    <script>
        const logContainer = document.getElementById('logs');

        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `log ${type}`;
            div.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logContainer.appendChild(div);
            console.log(message);
        }

        log('Starting Kakao SDK test...');
        log('API Key: b6df438d2c946f441b6ff06cd87868ba');

        const KAKAO_SDK_URL = 'https://dapi.kakao.com/v2/maps/sdk.js?appkey=b6df438d2c946f441b6ff06cd87868ba&libraries=services';

        log('Creating script tag...');
        log('SDK URL: ' + KAKAO_SDK_URL);

        const script = document.createElement('script');
        script.src = KAKAO_SDK_URL;
        script.async = true;

        script.onload = function() {
            log('✅ Script tag loaded', 'success');

            setTimeout(() => {
                log('Checking window.kakao: ' + !!window.kakao);
                log('Checking window.kakao.maps: ' + !!(window.kakao && window.kakao.maps));
                log('Checking window.kakao.maps.services: ' + !!(window.kakao && window.kakao.maps && window.kakao.maps.services));
                log('Checking window.kakao.maps.load: ' + !!(window.kakao && window.kakao.maps && typeof window.kakao.maps.load === 'function'));

                if (window.kakao && window.kakao.maps) {
                    log('Calling kakao.maps.load()...');

                    window.kakao.maps.load(() => {
                        log('✅ Inside kakao.maps.load callback', 'success');
                        log('Checking services after load: ' + !!window.kakao.maps.services);

                        if (window.kakao.maps.services) {
                            try {
                                const geocoder = new window.kakao.maps.services.Geocoder();
                                log('✅ Geocoder created successfully!', 'success');

                                // Test geocoding
                                geocoder.addressSearch('서울특별시 강남구 테헤란로 152', (result, status) => {
                                    log('Geocoding test result:');
                                    log('Status: ' + status);
                                    log('Result: ' + JSON.stringify(result, null, 2));

                                    if (status === window.kakao.maps.services.Status.OK && result && result.length) {
                                        log('✅ Geocoding test SUCCESS!', 'success');
                                        log('Coordinates: ' + result[0].y + ', ' + result[0].x);
                                    } else {
                                        log('❌ Geocoding test FAILED', 'error');
                                    }
                                });
                            } catch (err) {
                                log('❌ Error creating Geocoder: ' + err.message, 'error');
                            }
                        } else {
                            log('❌ services still not available', 'error');
                        }
                    });
                } else {
                    log('❌ window.kakao.maps not available', 'error');
                }
            }, 200);
        };

        script.onerror = function() {
            log('❌ Failed to load script', 'error');
        };

        document.head.appendChild(script);
    </script>
</body>
</html>
